var ge=n=>{throw TypeError(n)};var re=(n,e,t)=>e.has(n)||ge("Cannot "+t);var d=(n,e,t)=>(re(n,e,"read from private field"),t?t.call(n):e.get(n)),M=(n,e,t)=>e.has(n)?ge("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),p=(n,e,t,s)=>(re(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),f=(n,e,t)=>(re(n,e,"access private method"),t);function Ie(){const n=document.createElement("header");n.className="game-over-title",n.setAttribute("aria-hidden","true"),n.hidden=!0;const e=document.createElement("span");e.className="game-over-title__eyebrow",e.textContent="Flappy Bird 3D";const t=document.createElement("h2");t.className="game-over-title__heading",t.textContent="Game ";const s=document.createElement("span");return s.className="game-over-title__accent",s.textContent="Over",t.appendChild(s),n.append(e,t),{element:n,show(){n.hidden=!1,n.setAttribute("aria-hidden","false")},hide(){n.hidden=!0,n.setAttribute("aria-hidden","true")}}}var c=(n=>(n.None="none",n.Bronze="bronze",n.Silver="silver",n.Gold="gold",n.Platinum="platinum",n))(c||{});const Qe={none:null,bronze:{title:"Bronze Medal",description:"A solid start! Keep flapping to climb the ranks."},silver:{title:"Silver Medal",description:"Great flying! You're edging closer to greatness."},gold:{title:"Gold Medal",description:"Amazing! Only elite birds soar this high."},platinum:{title:"Platinum Medal",description:"Legendary flight path unlocked. The skies salute you!"}};var q;class Ve{constructor(){M(this,q,new Set)}onMedal(e){return d(this,q).add(e),()=>{d(this,q).delete(e)}}emitMedal(e){for(const t of d(this,q))t(e)}}q=new WeakMap;const X=new Ve,Ee={[c.None]:"",[c.Bronze]:"medal-banner--bronze",[c.Silver]:"medal-banner--silver",[c.Gold]:"medal-banner--gold",[c.Platinum]:"medal-banner--platinum"},Ge={[c.None]:"",[c.Bronze]:"ðŸ¥‰",[c.Silver]:"ðŸ¥ˆ",[c.Gold]:"ðŸ¥‡",[c.Platinum]:"ðŸ†"},Ue=n=>{if(typeof n=="string"){const t=document.querySelector(n);if(t)return t}else if(n instanceof HTMLElement)return n;const e=document.createElement("div");return document.body.appendChild(e),e};var Q,V,R,v,B,G,N,u,_e,Te,Re,Be,Ne,Se,xe,Fe,k,le;class $e{constructor(e={}){M(this,u);M(this,Q);M(this,V);M(this,R,null);M(this,v,null);M(this,B,c.None);M(this,G);M(this,N,null);p(this,V,e.adapter??X),p(this,G,e.autoHideMs??5e3),p(this,Q,f(this,u,_e).call(this,Ue(e.mount))),f(this,u,Te).call(this)}destroy(){d(this,R)&&(d(this,R).call(this),p(this,R,null)),f(this,u,k).call(this),d(this,v)&&(d(this,v).remove(),p(this,v,null))}}Q=new WeakMap,V=new WeakMap,R=new WeakMap,v=new WeakMap,B=new WeakMap,G=new WeakMap,N=new WeakMap,u=new WeakSet,_e=function(e){if(e.classList.contains("medal-banner-layer"))return e.setAttribute("aria-live",e.getAttribute("aria-live")??"polite"),e.setAttribute("role",e.getAttribute("role")??"status"),e;const t=document.createElement("div");return t.classList.add("medal-banner-layer"),t.setAttribute("aria-live","polite"),t.setAttribute("role","status"),e.appendChild(t),t},Te=function(){p(this,R,d(this,V).onMedal(e=>{f(this,u,Be).call(this,e)}))},Re=function(){if(d(this,v))return d(this,v);const e=document.createElement("article");return e.className="medal-banner",e.innerHTML=`
      <span class="medal-banner__emblem" aria-hidden="true"></span>
      <div class="medal-banner__copy">
        <strong class="medal-banner__title" data-medal-title></strong>
        <span class="medal-banner__description" data-medal-description></span>
      </div>
    `,d(this,Q).appendChild(e),p(this,v,e),e},Be=function(e){const{medal:t}=e;if(!t||t===c.None){f(this,u,le).call(this);return}const s=f(this,u,Re).call(this);f(this,u,Ne).call(this,s,e),f(this,u,Se).call(this,s,t);const r=e.persistent?null:e.durationMs??d(this,G);r!==null&&Number.isFinite(r)?f(this,u,Fe).call(this,r):f(this,u,k).call(this)},Ne=function(e,t){const{medal:s,title:r,description:o}=t,a=Qe[s],A=e.querySelector("[data-medal-title]"),S=e.querySelector("[data-medal-description]"),O=e.querySelector(".medal-banner__emblem");A&&(A.textContent=r??(a==null?void 0:a.title)??""),S&&(S.textContent=o??(a==null?void 0:a.description)??"",S.classList.toggle("is-hidden",!(o??(a==null?void 0:a.description)))),O&&(O.textContent=Ge[s]??"")},Se=function(e,t){d(this,B)!==t&&(f(this,u,xe).call(this,e,t),p(this,B,t)),e.dataset.medal=t,requestAnimationFrame(()=>{e.classList.add("is-active")})},xe=function(e,t){const s=Ee[t];for(const r of Object.values(Ee))r&&e.classList.remove(r);s&&e.classList.add(s)},Fe=function(e){f(this,u,k).call(this),p(this,N,window.setTimeout(()=>{f(this,u,le).call(this)},Math.max(0,e)))},k=function(){d(this,N)!==null&&(window.clearTimeout(d(this,N)),p(this,N,null))},le=function(){if(f(this,u,k).call(this),!d(this,v)){p(this,B,c.None);return}const e=d(this,v);e.classList.remove("is-active");const t=()=>{e.removeEventListener("transitionend",t),e.isConnected&&e.remove()};e.addEventListener("transitionend",t),window.setTimeout(t,450),p(this,v,null),p(this,B,c.None)};const Ke=1e3/24,je={cooldownMs:320,showDurationMs:680,queueLimit:4,srMessage:"Perfect timing!"};function Ye(n){return n?typeof n=="string"?document.querySelector(n):n??null:null}function Me(n,e=0){const t=Number(n);return Number.isFinite(t)?t:e}function Xe(n){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(n);return}setTimeout(()=>{const e=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();n(e)},Ke)}class Je{constructor(e={}){this.state="idle",this.queue=[],this.activeBadge=null,this.displayTimeout=null,this.cooldownTimeout=null,this.liveRegionReset=null,this.prefersReducedMotion=!1,this.motionQuery=null,this.detachAdapterListener=null,this.detachMotionListener=null;const{root:t,adapter:s,...r}=e;this.root=Ye(t??null),this.options={...je,...r},this.prefersReducedMotion=this.queryMotionPreference(),this.liveRegion=this.ensureLiveRegion(),this.applyBaseAttributes(),this.subscribeToMotionPreference(),s&&this.attachAdapter(s)}destroy(){var e;this.clearTimers(),(e=this.detachAdapterListener)==null||e.call(this),this.detachAdapterListener=null,this.teardownMotionPreference(),this.state="idle",this.activeBadge&&(this.activeBadge.remove(),this.activeBadge=null),this.queue=[],this.liveRegion&&(this.liveRegion.textContent="")}trigger(e,t=1){this.root&&(this.enqueue({score:e,delta:t}),this.processQueue())}attachAdapter(e){const t=r=>{const o=r==null?void 0:r.detail;if(!o)return;const a=Me(o.value,0),A=Math.max(1,Math.round(Me(o.delta,1)));this.enqueue({score:a,delta:A}),this.processQueue()},s=e.on("score:increment",t);typeof s=="function"?this.detachAdapterListener=s:e.off&&(this.detachAdapterListener=()=>{var r;return(r=e.off)==null?void 0:r.call(e,"score:increment",t)})}enqueue(e){const t=Math.max(1,this.options.queueLimit);this.queue.push(e),this.queue.length>t&&this.queue.splice(0,this.queue.length-t)}processQueue(){if(!this.root){this.queue=[];return}if(this.state!=="idle")return;const e=this.queue.shift();e&&this.present(e)}present(e){if(!this.root)return;this.state="display";const t=this.createBadge(e.delta);this.activeBadge=t,this.root.appendChild(t),Xe(()=>{t.classList.add("perfect-indicator__badge--active")}),this.announce(e.score);const s=this.getDisplayDuration();this.displayTimeout=setTimeout(()=>{this.displayTimeout=null,t.remove(),this.activeBadge=null,this.enterCooldown()},s)}enterCooldown(){this.state="cooldown";const e=this.getCooldownDuration();if(e<=0){this.state="idle",this.processQueue();return}this.cooldownTimeout=setTimeout(()=>{this.cooldownTimeout=null,this.state="idle",this.processQueue()},e)}getDisplayDuration(){const e=Math.max(0,this.options.showDurationMs);return this.prefersReducedMotion?Math.min(240,Math.max(120,Math.round(e/2))):e}getCooldownDuration(){const e=Math.max(0,this.options.cooldownMs);return this.prefersReducedMotion?Math.min(180,Math.round(e/2)):e}createBadge(e){const t=document.createElement("span");t.className="perfect-indicator__badge",t.setAttribute("aria-hidden","true");const s=Math.max(1,Math.round(e));return t.textContent=s>1?`Ã—${s}`:"âœ“",t}announce(e){this.liveRegion&&(this.liveRegion.textContent=`${this.options.srMessage} Score: ${e}`,this.liveRegionReset&&clearTimeout(this.liveRegionReset),this.liveRegionReset=setTimeout(()=>{this.liveRegion&&(this.liveRegion.textContent=""),this.liveRegionReset=null},Math.max(800,this.getDisplayDuration())))}ensureLiveRegion(){if(!this.root)return null;const e=this.root.querySelector('[data-perfect-indicator="sr"]');if(e)return e.classList.add("perfect-indicator__sr"),e;const t=document.createElement("span");return t.dataset.perfectIndicator="sr",t.className="perfect-indicator__sr",t.textContent="",this.root.appendChild(t),t}applyBaseAttributes(){this.root&&(this.root.classList.add("perfect-indicator"),this.root.hasAttribute("role")||this.root.setAttribute("role","status"),this.root.hasAttribute("aria-live")||this.root.setAttribute("aria-live","polite"),this.root.hasAttribute("aria-atomic")||this.root.setAttribute("aria-atomic","true"))}clearTimers(){this.displayTimeout&&(clearTimeout(this.displayTimeout),this.displayTimeout=null),this.cooldownTimeout&&(clearTimeout(this.cooldownTimeout),this.cooldownTimeout=null),this.liveRegionReset&&(clearTimeout(this.liveRegionReset),this.liveRegionReset=null)}queryMotionPreference(){if(typeof window>"u"||typeof window.matchMedia!="function")return!1;const e=window.matchMedia("(prefers-reduced-motion: reduce)");return this.motionQuery=e,e.matches}subscribeToMotionPreference(){if(!this.motionQuery)return;const e=t=>{this.prefersReducedMotion=t.matches};typeof this.motionQuery.addEventListener=="function"?(this.motionQuery.addEventListener("change",e),this.detachMotionListener=()=>{var t,s;(s=(t=this.motionQuery)==null?void 0:t.removeEventListener)==null||s.call(t,"change",e)}):typeof this.motionQuery.addListener=="function"&&(this.motionQuery.addListener(e),this.detachMotionListener=()=>{var t,s;(s=(t=this.motionQuery)==null?void 0:t.removeListener)==null||s.call(t,e)})}teardownMotionPreference(){var e;(e=this.detachMotionListener)==null||e.call(this),this.detachMotionListener=null}}function We(n){return typeof n=="string"?n.trim().toLowerCase():""}function Ze(n=typeof navigator<"u"?navigator:void 0){if(!n)return{supported:!1,vibrate:null};const e=n.vibrate;return typeof e!="function"?{supported:!1,vibrate:null}:{supported:!0,vibrate:s=>{try{return e.call(n,s)!==!1}catch(r){return console.warn("navigator.vibrate call failed",r),!1}}}}function et(n){return Number.isFinite(n)&&n>0&&n%10===0?[28,8,28]:18}const tt={bronze:[20,8,24],silver:[24,10,24,10,30],gold:[30,10,30,10,40],platinum:[36,12,36,12,48]},nt=[24,8,24,8,32];function st(n={}){const e=Ze(n.navigator),t=e.vibrate??(()=>!1),s=r=>t(r);return{supported:e.supported,scoreMilestone(r){return e.supported?s(et(r)):!1},medalEarned(r){if(!e.supported)return!1;const o=We(r),a=tt[o]??nt;return s(a)}}}const Pe="hud:best-ribbon",I=typeof window<"u"?window:null;function ye(n,e){I&&I.dispatchEvent(new CustomEvent(Pe,{detail:{type:n,score:e}}))}let oe=null;class it{constructor(){this.hideTimeout=null,this.handleEvent=o=>{if(!(o instanceof CustomEvent))return;const a=o.detail;a&&this.show(a)},this.element=document.createElement("div"),this.element.className="best-ribbon",this.element.setAttribute("role","status"),this.element.setAttribute("aria-live","polite");const e=document.createElement("span");e.className="best-ribbon__badge",e.setAttribute("aria-hidden","true"),e.textContent="ðŸ…";const t=document.createElement("div");t.className="best-ribbon__content";const s=document.createElement("span");s.className="best-ribbon__title",s.textContent="Best score",this.valueEl=document.createElement("span"),this.valueEl.className="best-ribbon__value",this.valueEl.textContent="0",this.statusEl=document.createElement("span"),this.statusEl.className="best-ribbon__status",t.append(s,this.valueEl,this.statusEl),this.element.append(e,t);const r=document.body??document.documentElement;r==null||r.appendChild(this.element),I==null||I.addEventListener(Pe,this.handleEvent)}show({score:e,type:t}){this.valueEl.textContent=String(e),this.statusEl.textContent=t==="beat"?"New record!":"Matched the best",this.element.dataset.state=t,this.element.classList.add("best-ribbon--visible"),this.hideTimeout!==null&&window.clearTimeout(this.hideTimeout),this.hideTimeout=window.setTimeout(()=>this.hide(),3200)}hide(){this.element.classList.remove("best-ribbon--visible"),this.element.removeAttribute("data-state"),this.hideTimeout!==null&&(window.clearTimeout(this.hideTimeout),this.hideTimeout=null)}}function rt(){return typeof document>"u"?null:(oe||(oe=new it),oe)}const Y=Object.freeze({bronze:10,silver:20,gold:30,platinum:40});function ot(n){if(!Number.isFinite(n))return"none";const e=Math.floor(n);return e>=Y.platinum?"platinum":e>=Y.gold?"gold":e>=Y.silver?"silver":e>=Y.bronze?"bronze":"none"}const at=Number.MAX_SAFE_INTEGER;function lt(n){return!Number.isFinite(n)||n<=0?0:Math.min(Math.floor(n),at)}function we(n){return lt(n).toLocaleString("en-US")}class ut{constructor(e={}){this.root=document.createElement("section"),this.root.className="final-score",this.root.hidden=!0,this.root.setAttribute("role","status"),this.root.setAttribute("aria-live","polite");const t=document.createElement("h2");t.className="final-score__title",t.textContent=e.heading??"Final score",this.root.appendChild(t);const s=document.createElement("div");s.className="final-score__metrics";const r=this.createMetric("Score");this.scoreValue=r.value,s.appendChild(r.container);const o=this.createMetric("Best");this.bestValue=o.value,s.appendChild(o.container),this.root.appendChild(s),this.badge=document.createElement("span"),this.badge.className="final-score__badge",this.badge.textContent="New personal best!",this.badge.setAttribute("role","note"),this.badge.hidden=!0,this.root.appendChild(this.badge)}createMetric(e){const t=document.createElement("div");t.className="final-score__metric";const s=document.createElement("span");s.className="final-score__label",s.textContent=e,t.appendChild(s);const r=document.createElement("span");return r.className="final-score__value",r.textContent="0",t.appendChild(r),{container:t,value:r}}get element(){return this.root}attach(e,t){t?e.insertBefore(this.root,t):e.appendChild(this.root)}setScores(e,t,s={}){this.scoreValue.textContent=we(e),this.bestValue.textContent=we(t);const r=s.isRecord??(e>0&&e>=t);this.badge.hidden=!r,this.root.classList.toggle("final-score--record",r)}show(){this.root.hidden=!1}hide(){this.root.hidden=!0}}function ct(n){return n?typeof n=="string"?document.querySelector(n):n:document.body}class dt{constructor(e={}){this.layers=new Map;const t=ct(e.host);if(!t)throw new Error("Unable to initialize HUD root: host element was not found.");this.host=t,this.root=document.createElement("div"),this.root.className="hud-root",this.host.appendChild(this.root),(e.layers??["base","modal"]).forEach(r=>{this.ensureLayer(r)})}getLayer(e){return this.ensureLayer(e)}mount(e,t="base"){const s=this.ensureLayer(t);e.parentElement!==s&&s.appendChild(e)}destroy(){this.layers.clear(),this.root.parentElement&&this.root.parentElement.removeChild(this.root)}ensureLayer(e){const t=this.layers.get(e);if(t)return t;const s=document.createElement("div");return s.className=`hud-layer hud-layer--${e}`,s.dataset.hudLayer=e,this.layers.set(e,s),this.root.appendChild(s),s}}const F={Open:"pause-menu:open",Close:"pause-menu:close",Resume:"pause-menu:resume",ToggleMute:"pause-menu:toggle-mute",Quit:"pause-menu:quit"},ht=["resume","mute","quit"];function ae(n){return!!n&&n instanceof HTMLElement&&!n.hasAttribute("disabled")}class mt{constructor(e={}){this.previouslyFocused=null,this.isOpen=!1,this.eventTarget=e.eventTarget??new EventTarget,this.muted=!!e.initialMuted,this.element=document.createElement("div"),this.element.className="pause-menu",this.element.setAttribute("role","dialog"),this.element.setAttribute("aria-modal","true"),this.element.setAttribute("aria-label",e.label??"Game paused"),this.element.hidden=!0,this.element.setAttribute("aria-hidden","true");const t=document.createElement("h2");t.className="pause-menu__title",t.textContent=e.label??"Paused";const s=document.createElement("p");s.className="pause-menu__description",s.textContent="Take a breather or adjust your settings.";const r=document.createElement("div");r.className="pause-menu__actions",this.buttons={resume:this.createButton("Resume","resume"),mute:this.createButton("Mute","mute"),quit:this.createButton("Quit","quit")},r.append(this.buttons.resume,this.buttons.mute,this.buttons.quit),this.element.append(t,s,r),this.updateMuteButton(),this.element.addEventListener("keydown",o=>this.handleKeydown(o))}addEventListener(e,t){this.eventTarget.addEventListener(e,t)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}open(){this.isOpen||(this.isOpen=!0,this.previouslyFocused=document.activeElement instanceof HTMLElement?document.activeElement:null,this.element.hidden=!1,this.element.setAttribute("aria-hidden","false"),this.focusFirstButton(),this.publish(F.Open))}close(){this.isOpen&&(this.isOpen=!1,this.element.hidden=!0,this.element.setAttribute("aria-hidden","true"),ae(this.previouslyFocused)&&document.contains(this.previouslyFocused)&&this.previouslyFocused.focus(),this.publish(F.Close))}setMuted(e){this.muted=!!e,this.updateMuteButton()}isVisible(){return this.isOpen}destroy(){this.close(),this.element.parentElement&&this.element.parentElement.removeChild(this.element)}createButton(e,t){const s=document.createElement("button");return s.type="button",s.className="game-button pause-menu__button",s.dataset.pauseMenuButton=t,s.textContent=e,s.addEventListener("click",()=>this.handleButtonActivate(t)),s}handleButtonActivate(e){switch(e){case"resume":this.publish(F.Resume),this.close();break;case"mute":this.muted=!this.muted,this.updateMuteButton(),this.publish(F.ToggleMute,{muted:this.muted});break;case"quit":this.publish(F.Quit);break}}focusFirstButton(){const e=this.buttons.resume;ae(e)&&e.focus()}getFocusableButtons(){return ht.map(e=>this.buttons[e]).filter(e=>ae(e))}handleKeydown(e){var t;if(this.isOpen)if(e.key==="Tab"){const s=this.getFocusableButtons();if(!s.length)return;const r=s.indexOf(document.activeElement);let o=r;e.shiftKey?o=r<=0?s.length-1:r-1:o=r===s.length-1?0:r+1,e.preventDefault(),(t=s[o])==null||t.focus()}else e.key==="Escape"&&(e.preventDefault(),this.publish(F.Resume),this.close())}updateMuteButton(){const e=this.buttons.mute;e.setAttribute("aria-pressed",this.muted?"true":"false"),e.textContent=this.muted?"Unmute":"Mute"}publish(e,t){const s=new CustomEvent(e,{bubbles:!1,cancelable:!1,detail:t});this.eventTarget.dispatchEvent(s)}}const Le="is-active",Ae="dim-layer--static";class ft{constructor(e,t={}){this.resizeObserver=null,this.rafHandle=null,this.isActive=!1,this.handleMotionPreference=()=>{this.prefersReducedMotion.matches?this.element.classList.add(Ae):this.element.classList.remove(Ae)},this.overlay=e;const s=t.host??e.parentElement;if(!s)throw new Error("DimLayer requires the overlay to have a parent element.");this.host=s,this.radiusSource=t.radiusSource??e,this.element=document.createElement("div"),this.element.className="dim-layer",this.element.setAttribute("aria-hidden","true");const r=document.createElement("div");r.className="dim-layer__backdrop";const o=document.createElement("div");o.className="dim-layer__frost";const a=document.createElement("div");a.className="dim-layer__glow",this.element.append(r,o,a),this.host.insertBefore(this.element,this.overlay),this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)"),this.handleMotionPreference(),typeof this.prefersReducedMotion.addEventListener=="function"?this.prefersReducedMotion.addEventListener("change",this.handleMotionPreference):typeof this.prefersReducedMotion.addListener=="function"&&this.prefersReducedMotion.addListener(this.handleMotionPreference),this.syncBorderRadius(),this.installResizeObserver()}installResizeObserver(){typeof ResizeObserver>"u"||(this.resizeObserver=new ResizeObserver(()=>{this.syncBorderRadius()}),this.resizeObserver.observe(this.radiusSource))}syncBorderRadius(){const e=getComputedStyle(this.radiusSource).borderRadius;e&&(this.element.style.borderRadius=e)}setActive(e){this.isActive!==e&&(this.isActive=e,e?(this.element.nextElementSibling!==this.overlay&&this.host.insertBefore(this.element,this.overlay),this.rafHandle!==null&&cancelAnimationFrame(this.rafHandle),this.rafHandle=requestAnimationFrame(()=>{this.element.classList.add(Le),this.rafHandle=null})):(this.rafHandle!==null&&(cancelAnimationFrame(this.rafHandle),this.rafHandle=null),this.element.classList.remove(Le)))}dispose(){this.rafHandle!==null&&(cancelAnimationFrame(this.rafHandle),this.rafHandle=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),typeof this.prefersReducedMotion.removeEventListener=="function"?this.prefersReducedMotion.removeEventListener("change",this.handleMotionPreference):typeof this.prefersReducedMotion.removeListener=="function"&&this.prefersReducedMotion.removeListener(this.handleMotionPreference),this.element.remove()}}const L={score:"#scoreValue",best:"#bestValue",message:"#gameMessage",overlay:"#gameOverlay",startButton:"#startButton",speedBar:"#speedFill",speedProgress:"#speedProgress",perfectIndicator:"#perfectIndicator"},T=()=>{};function y(n,e){const t=n??e;return t?typeof t=="string"?document.querySelector(t):t??null:null}function P(n,e=0){const t=Number(n);return Number.isFinite(t)?t:e}function Ce(n,e){n&&(n.textContent=String(e))}function z(n,e){n&&(n.classList.toggle("is-hidden",!e),"hidden"in n&&(n.hidden=!e))}function pt(n){return Number.isFinite(n)?Math.max(0,Math.min(1,n)):0}function vt(n={},e={}){const t=y(n.score,L.score),s=y(n.best,L.best),r=y(n.message,L.message),o=y(n.overlay,L.overlay),a=y(n.startButton,L.startButton),A=y(n.speedBar,L.speedBar),S=y(n.speedProgress,L.speedProgress),O=y(n.perfectIndicator,L.perfectIndicator),C=y(n.medal,null),qe=y(n.medalBanner,null);a instanceof HTMLButtonElement&&!a.hasAttribute("type")&&(a.type="button");const ue=(o==null?void 0:o.parentElement)??null,H=new $e({mount:qe??ue??void 0}),_=e.haptics??st(),ce=!!(_!=null&&_.supported),w=typeof EventTarget<"u"?new EventTarget:null,de=(i,l)=>w?(w.addEventListener(i,l),()=>w.removeEventListener(i,l)):T,he=(i,l)=>{w==null||w.removeEventListener(i,l)},J=(i,l)=>{w&&w.dispatchEvent(new CustomEvent(i,{detail:l}))},W=O&&w?new Je({root:O,adapter:{on:(i,l)=>de(i,l),off:(i,l)=>he(i,l)}}):null,h=o?new ut:null;o&&h&&(h.attach(o,a??null),h.hide());const b=o?new ft(o):null,Z=new dt({host:ue??document.body}),ee=new mt;Z.mount(ee.element,"modal");const m=o?Ie():null;m&&o&&(r?o.insertBefore(m.element,r):o.appendChild(m.element)),rt();let U=P((t==null?void 0:t.textContent)??0),g=U,x=P((s==null?void 0:s.textContent)??0),te=0,D=x,ne=0,$=c.None,me=(C==null?void 0:C.textContent)??null;const se=new Set,K=new Set,ie=i=>(K.add(i),()=>{K.delete(i),i()});if(a){const i=()=>{typeof a.blur=="function"&&a.blur()};a.addEventListener("click",i),ie(()=>{a.removeEventListener("click",i)})}const fe=i=>{r&&(r.textContent=i)},pe=i=>{C&&(C.textContent=i??"",i?C.dataset.medal=i:delete C.dataset.medal)},Oe=i=>{se.forEach(l=>{try{l(i)}catch(E){console.error("HUD medal listener error",E)}})},be=()=>{g<=0||(x>0&&g===x&&g>te&&g!==ne&&(ye("tie",g),te=g),g>D&&(ye("beat",g),D=g,ne=g))},ve=()=>{te=0,D=x,ne=0},He=(i,l)=>{!ce||typeof _.scoreMilestone!="function"||l>0&&_.scoreMilestone(i)},De=i=>{!ce||typeof _.medalEarned!="function"||i&&i!==c.None&&_.medalEarned(i)},j=i=>{i!==$&&($=i,pe(i===c.None?"":i),De(i),Oe(i))},ze={setScore(i){const l=P(i,0),E={value:l,previous:U,delta:l-U};Ce(t,l),E.delta!==0&&(J("score:change",E),E.delta>0?J("score:increment",E):J("score:decrement",E)),He(l,E.delta),U=l,g=l,be();const ke=ot(l);j(ke)},setBest(i){const l=P(i,0);Ce(s,l),x=l,D=Math.max(D,x),be()},setSpeed(i){const l=pt(i);A&&(A.style.width=`${l*100}%`),S&&S.setAttribute("aria-valuenow",String(Math.round(l*100)))},showIntro(){z(o,!0),b==null||b.setActive(!0),m==null||m.hide(),h==null||h.hide(),fe("Tap, click, or press Space to start"),a&&(a.textContent="Play",z(a,!0)),ve()},showRunning(){z(o,!1),b==null||b.setActive(!1),m==null||m.hide(),h==null||h.hide(),ve()},showGameOver(i,l,E={}){z(o,!0),b==null||b.setActive(!0),m==null||m.show(),fe("Game over! Tap or press Space to try again"),a&&(a.textContent="Play again",z(a,!0)),h==null||h.setScores(P(i,0),P(l,0),E),h==null||h.show()},destroy(){var i;K.forEach(l=>{l()}),K.clear(),W==null||W.destroy(),(i=H==null?void 0:H.destroy)==null||i.call(H),ee.destroy(),Z.destroy(),b==null||b.dispose(),m&&(o!=null&&o.contains(m.element))&&o.removeChild(m.element)},onStart(i=T){return!a||typeof i!="function"?T:(a.addEventListener("click",i),ie(()=>{a.removeEventListener("click",i)}))},onRestart(i=T){return!a||typeof i!="function"?T:(a.addEventListener("click",i),ie(()=>{a.removeEventListener("click",i)}))},awardMedal(i){if(!i||!i.medal){X.emitMedal({medal:c.None}),j(c.None);return}X.emitMedal(i),j(i.medal)},clearMedal(){X.emitMedal({medal:c.None}),j(c.None)},events:{on:de,off:he},onMedalChange(i=T){return typeof i!="function"?T:(se.add(i),()=>{se.delete(i)})},getCurrentMedal(){return $},pauseMenu:ee,hudRoot:Z};return me&&!$&&pe(me),ze}export{vt as c};
